<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokePoint - Sistema de Torneios VGC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header h1 {
            color: #333;
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tab-btn {
            padding: 0.8rem 1.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .tab-btn:hover, .tab-btn.active {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .auth-section {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .auth-btn, .admin-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .auth-btn {
            background: #28a745;
            color: white;
        }

        .admin-btn {
            background: #dc3545;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .ranking-list {
            display: grid;
            gap: 1rem;
        }

        .player-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .player-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(0,0,0,0.15);
        }

        .player-info h3 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .player-stats {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .points {
            background: #667eea;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
        }

        .tournament-points {
            background: #28a745;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .pokemon-team {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .pokemon-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .pokemon-card:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .pokemon-card img {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }

        .pokemon-name {
            font-weight: bold;
            margin-top: 0.5rem;
            text-transform: capitalize;
        }

        .likes {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            justify-content: center;
        }

        .like-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #ccc;
            transition: color 0.3s;
        }

        .like-btn.liked {
            color: #e74c3c;
        }

        .curt-btn {
            background: #ff6b9d;
            border: none;
            color: white;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 5px;
        }

        .curt-btn:hover {
            background: #e74c3c;
            transform: translateY(-2px);
        }

        .curt-btn.curtido {
            background: #27ae60;
        }

        .comentarios-btn {
            background: #3498db;
            border: none;
            color: rgb(0, 0, 0);
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 5px;
        }

        .comentarios-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .curtida-contador {
            background: rgba(255, 107, 157, 0.2);
            color: #ff6b9d;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .rating {
            display: flex;
            gap: 0.2rem;
            margin: 1rem 0;
            justify-content: center;
        }

        .star {
            font-size: 1.5rem;
            color: #000000;
            cursor: pointer;
            transition: color 0.3s;
        }

        .star:hover, .star.active {
            color: #ffc107;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .btn {
            background: #667eea;
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .pokemon-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 0.5rem;
        }

        .pokemon-option {
            text-align: center;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pokemon-option:hover {
            background: #f0f0f0;
        }

        .pokemon-option img {
            width: 40px;
            height: 40px;
        }

        .tournament-limits {
            background: #e9ecef;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .limit-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .hidden {
            display: none !important;
        }

        .admin-panel {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèÜ PokePoint VGC üèÜ</h1>
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('torneio1')">Torneio Alpha</button>
            <button class="tab-btn" onclick="showTab('torneio2')">Torneio Beta</button>
            <button class="tab-btn" onclick="showTab('torneio3')">Torneio Gamma</button>
            <button class="tab-btn" onclick="showTab('torneio4')">Torneio Delta</button>
        </div>
        <div class="auth-section">
            <button class="auth-btn" onclick="showLoginModal()">Login</button>
            <button class="auth-btn hidden" id="logoutBtn" onclick="logout()">Logout</button>
            <button class="admin-btn hidden" id="adminBtn" onclick="showAdminPanel()">Admin</button>
            <span id="userInfo" class="hidden"></span>
        </div>
    </div>

    <div class="container">
        <!-- Conte√∫do dos Torneios -->
        <div id="torneio1" class="tab-content active">
            <h2>Ranking - Torneio Alpha</h2>
            <div class="tournament-limits">
                <h4>Limite de Pontos: 50</h4>
            </div>
            <div id="ranking1" class="ranking-list">
                <div class="loading">Carregando rankings...</div>
            </div>
        </div>

        <div id="torneio2" class="tab-content">
            <h2>Ranking - Torneio Beta</h2>
            <div class="tournament-limits">
                <h4>Limite de Pontos: 30</h4>
            </div>
            <div id="ranking2" class="ranking-list">
                <div class="loading">Carregando rankings...</div>
            </div>
        </div>

        <div id="torneio3" class="tab-content">
            <h2>Ranking - Torneio Gamma</h2>
            <div class="tournament-limits">
                <h4>Limite de Pontos: 40</h4>
            </div>
            <div id="ranking3" class="ranking-list">
                <div class="loading">Carregando rankings...</div>
            </div>
        </div>

        <div id="torneio4" class="tab-content">
            <h2>Ranking - Torneio Delta</h2>
            <div class="tournament-limits">
                <h4>Limite de Pontos: 25</h4>
            </div>
            <div id="ranking4" class="ranking-list">
                <div class="loading">Carregando rankings...</div>
            </div>
        </div>
    </div>

    <!-- Modal de Login -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2>Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn">Entrar</button>
                <button type="button" class="btn" onclick="showRegisterForm()">Criar Conta</button>
            </form>
        </div>
    </div>

    <!-- Modal do Jogador -->
    <div id="playerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('playerModal')">&times;</span>
            <div id="playerDetails">
                <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Modal Admin -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('adminModal')">&times;</span>
            <h2>Painel Administrativo</h2>
            
            <div class="admin-panel">
                <h3>Adicionar/Atualizar Pontua√ß√£o</h3>
                <form id="pointsForm">
                    <div class="form-group">
                        <label for="playerName">Nome do Jogador:</label>
                        <input type="text" id="playerName" required>
                    </div>
                    <div class="form-group">
                        <label for="newPoints">Nova Pontua√ß√£o Total:</label>
                        <input type="number" id="newPoints" required>
                    </div>
                    <div class="form-group">
                        <label for="tournament">Torneio:</label>
                        <select id="tournament" required>
                            <option value="torneio1">Torneio Alpha (Limite: 50)</option>
                            <option value="torneio2">Torneio Beta (Limite: 30)</option>
                            <option value="torneio3">Torneio Gamma (Limite: 40)</option>
                            <option value="torneio4">Torneio Delta (Limite: 25)</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Atualizar Pontua√ß√£o</button>
                </form>
            </div>

            <div class="admin-panel">
                <hr>
                <h3>Criar Novo Jogador</h3>
                <form id="createPlayerForm">
                        <div class="form-group">
                            <label for="newPlayerName">Nome do Jogador:</label>
                            <input type="text" id="newPlayerName" required>
                        </div>
                        <div class="form-group">
                            <label for="newPlayerPoints">Pontua√ß√£o Inicial:</label>
                            <input type="number" id="newPlayerPoints" value="0" required>
                        </div>
                        <button type="submit" class="btn">Criar Jogador</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
        apiKey: "AIzaSyAexCf7hPN2OQvfsw66UDpci6nycivrK98",
        authDomain: "void-activation-system.firebaseapp.com",
        databaseURL: "https://void-activation-system-default-rtdb.firebaseio.com",
        projectId: "void-activation-system",
        storageBucket: "void-activation-system.firebasestorage.app",
        messagingSenderId: "108268095097",
        appId: "1:108268095097:web:4f45ff75a9e528b3f0f6a8",
        measurementId: "G-P71BZFRDQB"
        };
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Configura√ß√£o das cole√ß√µes
        const COLLECTION_NAME = 'vcgpoint';

        // Limites dos torneios
        const TOURNAMENT_LIMITS = {
            torneio1: 50,
            torneio2: 30,
            torneio3: 40,
            torneio4: 25
        };

        // Cache para Pok√©mon
        let pokemonCache = {};
        let allPokemon = [];

        // Estado da aplica√ß√£o
        let currentUser = null;
        let isAdmin = false;
        
        // SISTEMA DE CURTIDAS SIMPLES
        window.sistemaCurtidas = {
            curtidas: {}, // {teamId: numero_de_curtidas}
            usuariosCurtiram: {} // {teamId: [lista_de_user_ids]}
        };

        function curtirTime(playerId, teamId) {
            console.log('üéØ Curtir time chamado:', playerId, teamId);
            
            if (!currentUser) {
                alert('‚ùå Fa√ßa login para curtir!');
                showLoginModal();
                return;
            }
            
            const userEmail = currentUser.email;
            const chaveTime = `${playerId}_${teamId}`;
            
            // Inicializar se n√£o existir
            if (!window.sistemaCurtidas.curtidas[chaveTime]) {
                window.sistemaCurtidas.curtidas[chaveTime] = 0;
            }
            if (!window.sistemaCurtidas.usuariosCurtiram[chaveTime]) {
                window.sistemaCurtidas.usuariosCurtiram[chaveTime] = [];
            }
            
            const jaCurtiu = window.sistemaCurtidas.usuariosCurtiram[chaveTime].includes(userEmail);
            
            if (jaCurtiu) {
                // Remover curtida
                window.sistemaCurtidas.curtidas[chaveTime]--;
                window.sistemaCurtidas.usuariosCurtiram[chaveTime] = 
                    window.sistemaCurtidas.usuariosCurtiram[chaveTime].filter(email => email !== userEmail);
                console.log('üíî Curtida removida');
                alert('Curtida removida!');
            } else {
                // Adicionar curtida
                window.sistemaCurtidas.curtidas[chaveTime]++;
                window.sistemaCurtidas.usuariosCurtiram[chaveTime].push(userEmail);
                console.log('‚ù§Ô∏è Curtida adicionada');
                alert('Curtida adicionada!');
            }
            
            // Atualizar bot√£o visual
            atualizarBotaoCurtida(playerId, teamId);
            // Atualizar contador no cabe√ßalho
            atualizarContadorCurtidas(playerId);
            
            console.log('Estado atual:', window.sistemaCurtidas);
        }
        
        function atualizarBotaoCurtida(playerId, teamId) {
            const userEmail = currentUser ? currentUser.email : null;
            const chaveTime = `${playerId}_${teamId}`;
            
            // Encontrar o bot√£o
            const botoes = document.querySelectorAll(`[data-player-id="${playerId}"][data-team-id="${teamId}"]`);
            
            botoes.forEach(botao => {
                const jaCurtiu = userEmail && window.sistemaCurtidas.usuariosCurtiram[chaveTime] && 
                                window.sistemaCurtidas.usuariosCurtiram[chaveTime].includes(userEmail);
                
                if (jaCurtiu) {
                    botao.classList.add('curtido');
                    botao.textContent = 'Curtido ‚úì';
                } else {
                    botao.classList.remove('curtido');
                    botao.textContent = 'Curtir';
                }
            });
        }

        function atualizarContadorCurtidas(playerId) {
            // Calcular total de curtidas para este jogador
            let totalCurtidas = 0;
            Object.keys(window.sistemaCurtidas.curtidas).forEach(chave => {
                if (chave.startsWith(`${playerId}_`)) {
                    totalCurtidas += window.sistemaCurtidas.curtidas[chave];
                }
            });
            
            // Atualizar contador no cabe√ßalho se existir
            const contador = document.querySelector(`#curtida-contador-${playerId}`);
            if (contador) {
                contador.textContent = `${totalCurtidas} curtidas`;
            }
        }

        function comentarTime(playerId, teamId) {
            if (!currentUser) {
                alert('‚ùå Fa√ßa login para comentar!');
                showLoginModal();
                return;
            }
            
            const comentario = prompt('Digite seu coment√°rio:');
            if (comentario && comentario.trim()) {
                alert(`Coment√°rio salvo: "${comentario}"`);
                console.log(`Coment√°rio no time ${teamId} do jogador ${playerId}: ${comentario}`);
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            const createPlayerForm = document.getElementById('createPlayerForm');
            if (createPlayerForm) {
                createPlayerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const name = document.getElementById('newPlayerName').value;
                    const points = parseInt(document.getElementById('newPlayerPoints').value);
                    try {
                        const playersRef = db.collection(COLLECTION_NAME).collection('players');
                        const querySnapshot = await playersRef.where('name', '==', name).get();
                        if (!querySnapshot.empty) {
                            alert('J√° existe um jogador com esse nome!');
                            return;
                        }
                        const tournaments = {
                            torneio1: 0,
                            torneio2: 0,
                            torneio3: 0,
                            torneio4: 0
                        };
                        await playersRef.add({
                            name: name,
                            totalPoints: points,
                            tournaments: tournaments,
                            teams: [],
                            rating: 0
                        });
                        alert('Jogador criado com sucesso!');
                        document.getElementById('createPlayerForm').reset();
                        loadRankings();
                    } catch (error) {
                        console.error('Erro ao criar jogador:', error);
                        alert('Erro ao criar jogador');
                    }
                });
            }
        });


        function initializeApp() {
            auth.onAuthStateChanged(user => {
                currentUser = user;
                if (user) {
                    document.getElementById('logoutBtn').classList.remove('hidden');
                    document.querySelector('.auth-btn').classList.add('hidden');
                    document.getElementById('userInfo').classList.remove('hidden');
                    document.getElementById('userInfo').textContent = `Ol√°, ${user.email}`;
                    checkAdminStatus(user.email);
                    
                    // Atualizar bot√µes de curtida quando usu√°rio faz login
                    atualizarTodosBotoesCurtida();
                } else {
                    document.getElementById('logoutBtn').classList.add('hidden');
                    document.querySelector('.auth-btn').classList.remove('hidden');
                    document.getElementById('userInfo').classList.add('hidden');
                    document.getElementById('adminBtn').classList.add('hidden');
                    isAdmin = false;
                }
            });

            loadAllPokemon();
            loadRankings();
        }
        
        function atualizarTodosBotoesCurtida() {
            // Atualizar todos os bot√µes de curtida vis√≠veis
            document.querySelectorAll('.curt-btn[data-player-id][data-team-id]').forEach(botao => {
                const playerId = botao.getAttribute('data-player-id');
                const teamId = botao.getAttribute('data-team-id');
                atualizarBotaoCurtida(playerId, teamId);
            });
        }

        function checkAdminStatus(email) {
            // Lista de emails de administradores
            const adminEmails = ['admin@pokepoint.com', 'seu-email@admin.com'];
            if (adminEmails.includes(email)) {
                isAdmin = true;
                document.getElementById('adminBtn').classList.remove('hidden');
            }
        }

        // Autentica√ß√£o
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showRegisterForm() {
            const form = document.getElementById('loginForm');
            form.innerHTML = `
                <div class="form-group">
                    <label for="regEmail">Email:</label>
                    <input type="email" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Senha:</label>
                    <input type="password" id="regPassword" required>
                </div>
                <button type="button" class="btn" onclick="register()">Criar Conta</button>
                <button type="button" class="btn" onclick="showLoginForm()">Voltar ao Login</button>
            `;
        }

        function showLoginForm() {
            const form = document.getElementById('loginForm');
            form.innerHTML = `
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn">Entrar</button>
                <button type="button" class="btn" onclick="showRegisterForm()">Criar Conta</button>
            `;
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    closeModal('loginModal');
                })
                .catch(error => {
                    alert('Erro no login: ' + error.message);
                });
        });

        function register() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => {
                    closeModal('loginModal');
                })
                .catch(error => {
                    alert('Erro no registro: ' + error.message);
                });
        }

        function logout() {
            auth.signOut();
        }

        // Navega√ß√£o entre abas
        function showTab(tabId) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover classe active de todos os bot√µes
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabId).classList.add('active');
            
            // Adicionar classe active ao bot√£o
            event.target.classList.add('active');
        }

        // Carregar Pok√©mon da API
        async function loadAllPokemon() {
            try {
                // Carregar todas as gera√ß√µes at√© a 9
                const generations = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                for (let gen of generations) {
                    const response = await fetch(`https://pokeapi.co/api/v2/generation/${gen}`);
                    const data = await response.json();
                    
                    for (let species of data.pokemon_species) {
                        const pokemonResponse = await fetch(species.url.replace('pokemon-species', 'pokemon'));
                        const pokemonData = await pokemonResponse.json();
                        
                        pokemonCache[pokemonData.id] = {
                            id: pokemonData.id,
                            name: pokemonData.name,
                            sprite: pokemonData.sprites.front_default
                        };
                        allPokemon.push(pokemonCache[pokemonData.id]);
                    }
                }
                
                console.log('Pok√©mon carregados:', allPokemon.length);
                const container = document.getElementById('pokemonSelection');
                if (container) {
                    setupPokemonSelection();
                } else {
                    console.warn('Elemento pokemonSelection n√£o encontrado no DOM. Verifique o HTML.');
                }
            } catch (error) {
                console.error('Erro ao carregar Pok√©mon:', error);
            }
        }

        function setupPokemonSelection() {
            const container = document.getElementById('pokemonSelection');
            container.innerHTML = '<h4>Selecione 6 Pok√©mon para o time:</h4>';
            
            for (let i = 1; i <= 6; i++) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="form-group">
                        <label>Pok√©mon ${i}:</label>
                        <input type="text" id="pokemon${i}Search" placeholder="Digite o nome do Pok√©mon" onkeyup="searchPokemon(${i})">
                        <div id="pokemon${i}Results" class="pokemon-selector" style="display: none;"></div>
                        <input type="hidden" id="pokemon${i}Selected">
                    </div>
                `;
                container.appendChild(div);
            }
        }

        function searchPokemon(slotNumber) {
            const searchTerm = document.getElementById(`pokemon${slotNumber}Search`).value.toLowerCase();
            const resultsContainer = document.getElementById(`pokemon${slotNumber}Results`);
            
            if (searchTerm.length < 2) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            const filteredPokemon = allPokemon.filter(pokemon => 
                pokemon.name.toLowerCase().includes(searchTerm)
            ).slice(0, 20);
            
            resultsContainer.innerHTML = '';
            filteredPokemon.forEach(pokemon => {
                const div = document.createElement('div');
                div.className = 'pokemon-option';
                div.innerHTML = `
                    <img src="${pokemon.sprite}" alt="${pokemon.name}">
                    <div class="pokemon-name">${pokemon.name}</div>
                `;
                div.onclick = () => selectPokemon(slotNumber, pokemon);
                resultsContainer.appendChild(div);
            });
            
            resultsContainer.style.display = 'block';
        }

        function selectPokemon(slotNumber, pokemon) {
            document.getElementById(`pokemon${slotNumber}Search`).value = pokemon.name;
            document.getElementById(`pokemon${slotNumber}Selected`).value = pokemon.id;
            document.getElementById(`pokemon${slotNumber}Results`).style.display = 'none';
        }

        // Carregar rankings
        async function loadRankings() {
            for (let i = 1; i <= 4; i++) {
                const tournamentId = `torneio${i}`;
                const rankingContainer = document.getElementById(`ranking${i}`);
                
                try {
                    const playersRef = db.collection(COLLECTION_NAME).collection('players');
                    const snapshot = await playersRef.get();
                    
                    const players = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.tournaments && data.tournaments[tournamentId]) {
                            players.push({
                                id: doc.id,
                                name: data.name,
                                totalPoints: data.totalPoints || 0,
                                tournamentPoints: data.tournaments[tournamentId] || 0,
                                teams: data.teams || [],
                                rating: data.rating || 0
                            });
                        }
                    });
                    
                    // Ordenar por pontua√ß√£o total
                    players.sort((a, b) => b.totalPoints - a.totalPoints);
                    
                    renderRanking(rankingContainer, players, tournamentId);
                } catch (error) {
                    console.error('Erro ao carregar ranking:', error);
                    rankingContainer.innerHTML = '<div class="loading">Erro ao carregar dados</div>';
                }
            }
        }

        function renderRanking(container, players, tournamentId) {
            if (players.length === 0) {
                container.innerHTML = '<div class="loading">Nenhum jogador registrado neste torneio</div>';
                return;
            }
            
            container.innerHTML = '';
            players.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player-card';
                div.innerHTML = `
                    <div class="player-info">
                        <h3>#${index + 1} - ${player.name}</h3>
                        <div class="rating">
                            ${'‚òÖ'.repeat(Math.floor(player.rating))}${'‚òÜ'.repeat(5 - Math.floor(player.rating))}
                            (${player.rating.toFixed(1)})
                        </div>
                    </div>
                    <div class="player-stats">
                        <div class="tournament-points">+${player.tournamentPoints} pts</div>
                        <div class="points">${player.totalPoints} pts</div>
                    </div>
                `;
                div.onclick = () => showPlayerDetails(player);
                container.appendChild(div);
            });
        }

        // Mostrar detalhes do jogador
        async function showPlayerDetails(player) {
            const modal = document.getElementById('playerModal');
            const detailsContainer = document.getElementById('playerDetails');
            
            let teamsHtml = '';
            if (player.teams && player.teams.length > 0) {
                const topTeam = player.teams.reduce((top, team) => 
                    (team.likes || 0) > (top.likes || 0) ? team : top
                );
                
                teamsHtml = `
                    <div class="pokemon-team">
                        <h3>Time Principal (${topTeam.likes || 0} curtidas)</h3>
                        ${await renderPokemonTeam(topTeam.pokemon)}
                        <div style="text-align: center; margin-top: 15px;">
                            ${currentUser ? `
                                <button class="curt-btn" data-player-id="${player.id}" data-team-id="${topTeam.id}" onclick="curtirTime('${player.id}', '${topTeam.id}')">Curtir</button>
                                <button class="comentarios-btn" onclick="comentarTime('${player.id}', '${topTeam.id}')">Coment√°rios</button>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                if (player.teams.length > 1) {
                    teamsHtml += '<h3>Outros Times:</h3>';
                    for (let team of player.teams) {
                        if (team.id !== topTeam.id) {
                            teamsHtml += `
                                <div class="pokemon-team">
                                    <h4>${team.name} (${team.likes || 0} curtidas)</h4>
                                    ${await renderPokemonTeam(team.pokemon)}
                                    <div style="text-align: center; margin-top: 15px;">
                                        ${currentUser ? `
                                            <button class="curt-btn" data-player-id="${player.id}" data-team-id="${team.id}" onclick="curtirTime('${player.id}', '${team.id}')">Curtir</button>
                                            <button class="comentarios-btn" onclick="comentarTime('${player.id}', '${team.id}')">Coment√°rios</button>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }
                    }
                }
            }
            
            detailsContainer.innerHTML = `
                <h2>${player.name} <span id="curtida-contador-${player.id}" class="curtida-contador">0 curtidas</span></h2>
                <div class="player-stats">
                    <div class="points">Total: ${player.totalPoints} pontos</div>
                </div>
                
                <h3>Pontua√ß√£o por Torneio:</h3>
                <div class="tournament-breakdown">
                    <div>Torneio Alpha: ${player.tournaments?.torneio1 || 0} pontos</div>
                    <div>Torneio Beta: ${player.tournaments?.torneio2 || 0} pontos</div>
                    <div>Torneio Gamma: ${player.tournaments?.torneio3 || 0} pontos</div>
                    <div>Torneio Delta: ${player.tournaments?.torneio4 || 0} pontos</div>
                </div>
                
                <div class="rating">
                    <h3>Avalia√ß√£o:</h3>
                    ${currentUser ? renderRatingStars(player.rating || 0, player.id) : `<div>${'‚òÖ'.repeat(Math.floor(player.rating || 0))}${'‚òÜ'.repeat(5 - Math.floor(player.rating || 0))} (${(player.rating || 0).toFixed(1)})</div>`}
                </div>
                
                ${teamsHtml}
                
                ${currentUser && !isAdmin ? `
                    <div>
                        <h3>Adicionar Time Usado Contra Este Jogador:</h3>
                        <form onsubmit="submitOpponentTeam(event, '${player.id}')">
                            <div class="form-group">
                                <label>Nome do seu time:</label>
                                <input type="text" id="opponentTeamName" required>
                            </div>
                            <div id="opponentPokemonSelection"></div>
                            <button type="submit" class="btn">Adicionar Time</button>
                        </form>
                    </div>
                ` : ''}
            `;
            
            if (currentUser && !isAdmin) {
                setupOpponentPokemonSelection();
            }
            
            // Atualizar contadores e bot√µes
            setTimeout(() => {
                atualizarContadorCurtidas(player.id);
                atualizarTodosBotoesCurtida();
            }, 100);
            
            modal.style.display = 'block';
        }

        async function renderPokemonTeam(pokemonIds) {
            let html = '<div class="pokemon-team">';
            for (let id of pokemonIds) {
                if (pokemonCache[id]) {
                    const pokemon = pokemonCache[id];
                    html += `
                        <div class="pokemon-card">
                            <img src="${pokemon.sprite}" alt="${pokemon.name}">
                            <div class="pokemon-name">${pokemon.name}</div>
                        </div>
                    `;
                }
            }
            html += '</div>';
            return html;
        }

        function renderRatingStars(currentRating, playerId) {
            let html = '<div class="rating">';
            for (let i = 1; i <= 5; i++) {
                const active = i <= currentRating ? 'active' : '';
                html += `<span class="star ${active}" onclick="ratePlayer('${playerId}', ${i})">‚òÖ</span>`;
            }
            html += '</div>';
            return html;
        }

        async function ratePlayer(playerId, rating) {
            if (!currentUser) return;
            
            try {
                const playerRef = db.collection(COLLECTION_NAME).collection('players').doc(playerId);
                const ratingRef = db.collection(COLLECTION_NAME).doc('ratings').collection(playerId).doc(currentUser.uid);
                
                await ratingRef.set({ rating, userId: currentUser.uid });
                
                // Recalcular m√©dia
                const ratingsSnapshot = await db.collection(COLLECTION_NAME).doc('ratings').collection(playerId).get();
                let totalRating = 0;
                let count = 0;
                
                ratingsSnapshot.forEach(doc => {
                    totalRating += doc.data().rating;
                    count++;
                });
                
                const averageRating = count > 0 ? totalRating / count : 0;
                await playerRef.update({ rating: averageRating });
                
                // Recarregar dados
                loadRankings();
                
                // Atualizar stars na modal
                document.querySelectorAll('.star').forEach((star, index) => {
                    star.classList.toggle('active', index < rating);
                });
                
            } catch (error) {
                console.error('Erro ao avaliar jogador:', error);
            }
        }

        // FUN√á√ÉO TOGGLE LIKE REMOVIDA - USANDO NOVO SISTEMA curtirTime()

        // Painel Admin
        function showAdminPanel() {
            if (!isAdmin) return;
            document.getElementById('adminModal').style.display = 'block';
        }

        document.getElementById('pointsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const playerName = document.getElementById('playerName').value;
            const newPoints = parseInt(document.getElementById('newPoints').value);
            const tournamentId = document.getElementById('tournament').value;
            
            try {
                const playersRef = db.collection(COLLECTION_NAME).collection('players');

                // Procurar jogador existente ou criar novo
                const querySnapshot = await playersRef.where('name', '==', playerName).get();
                let playerDoc;
                
                if (querySnapshot.empty) {
                    // Criar novo jogador
                    playerDoc = await playersRef.add({
                        name: playerName,
                        totalPoints: newPoints,
                        tournaments: { [tournamentId]: newPoints },
                        teams: [],
                        rating: 0
                    });
                } else {
                    // Atualizar jogador existente
                    playerDoc = querySnapshot.docs[0];
                    const playerData = playerDoc.data();
                    const currentTournamentPoints = playerData.tournaments?.[tournamentId] || 0;
                    const pointsEarned = newPoints - (playerData.totalPoints - currentTournamentPoints);
                    
                    // Aplicar limite do torneio
                    const limit = TOURNAMENT_LIMITS[tournamentId];
                    const finalPointsEarned = Math.min(pointsEarned, limit);
                    
                    const newTotalPoints = (playerData.totalPoints - currentTournamentPoints) + finalPointsEarned;
                    
                    await playerDoc.ref.update({
                        totalPoints: newTotalPoints,
                        [`tournaments.${tournamentId}`]: finalPointsEarned
                    });
                }
                
                alert('Pontua√ß√£o atualizada com sucesso!');
                document.getElementById('pointsForm').reset();
                loadRankings();
                
            } catch (error) {
                console.error('Erro ao atualizar pontua√ß√£o:', error);
                alert('Erro ao atualizar pontua√ß√£o');
            }
        });

        document.getElementById('teamForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const playerName = document.getElementById('teamPlayerName').value;
            const teamName = document.getElementById('teamName').value;
            
            const selectedPokemon = [];
            for (let i = 1; i <= 6; i++) {
                const pokemonId = document.getElementById(`pokemon${i}Selected`).value;
                if (pokemonId) {
                    selectedPokemon.push(parseInt(pokemonId));
                }
            }
            
            if (selectedPokemon.length !== 6) {
                alert('Selecione exatamente 6 Pok√©mon');
                return;
            }
            
            try {
                const playersRef = db.collection(COLLECTION_NAME).collection('players');
                const querySnapshot = await playersRef.where('name', '==', playerName).get();
                
                if (querySnapshot.empty) {
                    alert('Jogador n√£o encontrado');
                    return;
                }
                
                const playerDoc = querySnapshot.docs[0];
                const playerData = playerDoc.data();
                const teams = playerData.teams || [];
                
                const newTeam = {
                    id: Date.now().toString(),
                    name: teamName,
                    pokemon: selectedPokemon,
                    likes: 0,
                    likedBy: []
                };
                
                teams.push(newTeam);
                
                await playerDoc.ref.update({ teams });
                
                alert('Time adicionado com sucesso!');
                document.getElementById('teamForm').reset();
                
                // Limpar sele√ß√£o de Pok√©mon
                for (let i = 1; i <= 6; i++) {
                    document.getElementById(`pokemon${i}Search`).value = '';
                    document.getElementById(`pokemon${i}Selected`).value = '';
                }
                
            } catch (error) {
                console.error('Erro ao adicionar time:', error);
                alert('Erro ao adicionar time');
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const createPlayerForm = document.getElementById('createPlayerForm');
            if (createPlayerForm) {
                createPlayerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const name = document.getElementById('newPlayerName').value;
                    const points = parseInt(document.getElementById('newPlayerPoints').value);
                    try {
                        const playersRef = db.collection(COLLECTION_NAME).collection('players');
                        const querySnapshot = await playersRef.where('name', '==', name).get();
                        if (!querySnapshot.empty) {
                            alert('J√° existe um jogador com esse nome!');
                            return;
                        }
                        const tournaments = {
                            torneio1: 0,
                            torneio2: 0,
                            torneio3: 0,
                            torneio4: 0
                        };
                        await playersRef.add({
                            name: name,
                            totalPoints: points,
                            tournaments: tournaments,
                            teams: [],
                            rating: 0
                        });
                        alert('Jogador criado com sucesso!');
                        document.getElementById('createPlayerForm').reset();
                        loadRankings();
                    } catch (error) {
                        console.error('Erro ao criar jogador:', error);
                        alert('Erro ao criar jogador');
                    }
                });
            } else {
                console.warn('Elemento createPlayerForm n√£o encontrado no DOM. Verifique o HTML.');
            }

            async function loadAllPokemon() {
                try {
                    const generations = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                    for (let gen of generations) {
                        const response = await fetch(`https://pokeapi.co/api/v2/generation/${gen}`);
                        const data = await response.json();
                        for (let species of data.pokemon_species) {
                            const pokemonResponse = await fetch(species.url.replace('pokemon-species', 'pokemon'));
                            const pokemonData = await pokemonResponse.json();
                            pokemonCache[pokemonData.id] = {
                                id: pokemonData.id,
                                name: pokemonData.name,
                                sprite: pokemonData.sprites.front_default
                            };
                            allPokemon.push(pokemonCache[pokemonData.id]);
                        }
                    }
                    console.log('Pok√©mon carregados:', allPokemon.length);
                    const container = document.getElementById('pokemonSelection');
                    if (container) {
                        setupPokemonSelection();
                    } else {
                        console.warn('Elemento pokemonSelection n√£o encontrado no DOM. Verifique o HTML.');
                    }
                } catch (error) {
                    console.error('Erro ao carregar Pok√©mon:', error);
                }
            }

            loadAllPokemon();
        });

        function setupOpponentPokemonSelection() {
            const container = document.getElementById('opponentPokemonSelection');
            container.innerHTML = '<h4>Selecione 6 Pok√©mon do seu time:</h4>';
            
            for (let i = 1; i <= 6; i++) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="form-group">
                        <label>Pok√©mon ${i}:</label>
                        <input type="text" id="oppPokemon${i}Search" placeholder="Digite o nome do Pok√©mon" onkeyup="searchOpponentPokemon(${i})">
                        <div id="oppPokemon${i}Results" class="pokemon-selector" style="display: none;"></div>
                        <input type="hidden" id="oppPokemon${i}Selected">
                    </div>
                `;
                container.appendChild(div);
            }
        }

        function searchOpponentPokemon(slotNumber) {
            const searchTerm = document.getElementById(`oppPokemon${slotNumber}Search`).value.toLowerCase();
            const resultsContainer = document.getElementById(`oppPokemon${slotNumber}Results`);
            
            if (searchTerm.length < 2) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            const filteredPokemon = allPokemon.filter(pokemon => 
                pokemon.name.toLowerCase().includes(searchTerm)
            ).slice(0, 20);
            
            resultsContainer.innerHTML = '';
            filteredPokemon.forEach(pokemon => {
                const div = document.createElement('div');
                div.className = 'pokemon-option';
                div.innerHTML = `
                    <img src="${pokemon.sprite}" alt="${pokemon.name}">
                    <div class="pokemon-name">${pokemon.name}</div>
                `;
                div.onclick = () => selectOpponentPokemon(slotNumber, pokemon);
                resultsContainer.appendChild(div);
            });
            
            resultsContainer.style.display = 'block';
        }

        function selectOpponentPokemon(slotNumber, pokemon) {
            document.getElementById(`oppPokemon${slotNumber}Search`).value = pokemon.name;
            document.getElementById(`oppPokemon${slotNumber}Selected`).value = pokemon.id;
            document.getElementById(`oppPokemon${slotNumber}Results`).style.display = 'none';
        }

        async function submitOpponentTeam(event, playerId) {
            event.preventDefault();
            
            if (!currentUser) return;
            
            const teamName = document.getElementById('opponentTeamName').value;
            const selectedPokemon = [];
            
            for (let i = 1; i <= 6; i++) {
                const pokemonId = document.getElementById(`oppPokemon${i}Selected`).value;
                if (pokemonId) {
                    selectedPokemon.push(parseInt(pokemonId));
                }
            }
            
            if (selectedPokemon.length !== 6) {
                alert('Selecione exatamente 6 Pok√©mon');
                return;
            }
            
            try {
                const playerRef = db.collection(COLLECTION_NAME).collection('players').doc(playerId);
                const playerDoc = await playerRef.get();
                const playerData = playerDoc.data();
                const teams = playerData.teams || [];
                
                const newTeam = {
                    id: Date.now().toString(),
                    name: `${teamName} (vs ${currentUser.email})`,
                    pokemon: selectedPokemon,
                    likes: 0,
                    likedBy: [],
                    submittedBy: currentUser.uid
                };
                
                teams.push(newTeam);
                
                await playerRef.update({ teams });
                
                alert('Time adicionado com sucesso!');
                closeModal('playerModal');
                
            } catch (error) {
                console.error('Erro ao adicionar time:', error);
                alert('Erro ao adicionar time');
            }
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Inicializar aplica√ß√£o quando carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando aplica√ß√£o...');
            initializeApp();
        });
    </script>
</body>
</html>
